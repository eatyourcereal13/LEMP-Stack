# LEMP Stack в Docker

Простой контейнер с LEMP стеком (RockyLinux, Nginx, PHP-FPM, MariaDB), который показывает данные из базы на главной странице и метрики Nginx.

## Что внутри

**LEMP Stack:**
- **Linux:** Rocky Linux 9 (RPM-based)
- **Nginx:** Веб-сервер с метриками
- **PHP-FPM:** Обработчик PHP скриптов  
- **MariaDB:** База данных с тестовыми данными

**Что делает:**
- Главная страница выводит 2 строки из базы данных
- `/metrics` - отдает метрики Nginx в формате stub_status
- Автоматически инициализирует БД при первом запуске

## Быстрый старт

**Требования:**
- Docker

Сначала склонируйте репозиторий:

```bash
git clone https://github.com/eatyourcereal13/LEMP-Stack.git
cd LEMP-Stack
```

```bash
# Собрать образ
docker build -t rocky .

# Запустить контейнер
docker run -d -p 8080:80 --name lemp rocky
```

## Что проверять

1. **Главная страница:** http://localhost:8080/
   ```
   Привет
   Мир
   ```

2. **Метрики Nginx:** http://localhost:8080/metrics
   ```
   Active connections: 2
   server accepts handled requests
    10 10 15
   Reading: 0 Writing: 1 Waiting: 1
   ```

## Про метрики Nginx

Что означают цифры на `/metrics`:

- **Active connections:** сколько сейчас соединений активно
- **Accepts:** сколько всего соединений принял сервер
- **Handled:** сколько соединений обработал (должно = Accepts)
- **Requests:** сколько HTTP запросов обработал
- **Reading:** соединения читают заголовки запроса
- **Writing:** соединения отправляют ответ
- **Waiting:** соединения в режиме ожидания

## Структура файлов

```
.
├── Dockerfile     # Описание контейнера
├── init.sh       # Скрипт запуска всех сервисов
├── nginx.conf    # Конфиг Nginx с метриками
├── index.php     # Главная страница (PHP + БД)
└──  init.sql      # Настройка БД и тестовые данные
```

## Если что-то не работает

```bash

# Проверить процессы в контейнере
docker exec lemp ps aux

# Зайти внутрь контейнера
docker exec -it lemp bash
```

## Особенности реализации

- **Всё в одном контейнере**
- **Автоматическое создание БД**
- **Встроенные Nginx метрики**

---

**Для разработчиков:** если хочется поменять пароль БД или добавить свои данные - править в `init.sql` и `index.php`.
**Было принято решение не выносить меняемые данные в .env, тк решил, что это избыточно. В реальной реализации вынести 100%**
